public with sharing class EmailMessageBounceJob {

    // ‚è±Ô∏è –°–∫—ñ–ª—å–∫–∏ —Ö–≤–∏–ª–∏–Ω –Ω–∞–∑–∞–¥ –¥–∏–≤–∏–º–æ—Å—å
    private static final Integer LOOKBACK_MINUTES = 5;

    public static void process() {
        System.debug('=== EmailMessageBounceJob.process START ===');

        Datetime sinceTime = System.now().addMinutes(-LOOKBACK_MINUTES);
        System.debug('Looking for bounced emails since: ' + sinceTime);

        List<EmailMessage> bouncedEmails = [
            SELECT Id, IsBounced, RelatedToId, CreatedDate
            FROM EmailMessage
            WHERE IsBounced = true
            AND CreatedDate >= :sinceTime
        ];

        System.debug('Bounced EmailMessages found: ' + bouncedEmails.size());

        if (bouncedEmails.isEmpty()) {
            System.debug('No bounced emails to process');
            return;
        }

        // üëâ –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ç–æ–π —Å–∞–º–∏–π handler, —â–æ —ñ –∑ trigger
        BounceEmailFromEmailMessageHandler.handle(bouncedEmails);

        System.debug('=== EmailMessageBounceJob.process END ===');
    }
}